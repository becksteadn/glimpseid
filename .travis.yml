sudo: required
language: python
addons:
  firefox: latest
env:
  global:
    - MOZ_HEADLESS=1
    - BASE_URL="http://localhost:5500/"

services:
  - docker

before_install:
  - wget https://github.com/mozilla/geckodriver/releases/download/v0.21.0/geckodriver-v0.21.0-linux64.tar.gz
  - tar -xvzf geckodriver-v0.21.0-linux64.tar.gz
  - chmod +x geckodriver
  - sudo mv geckodriver /usr/local/bin

script:
  - whereis firefox
  - make run
  - make stop

before_deploy:
  - cd $TRAVIS_BUILD_DIR
  - sed -i -e 's/var ENV = \"test\";/var ENV = \"run\";/g' src/scripts/glimpse.js

deploy:
  provider: pages
  target_branch: gh-pages
  local_dir: src
  skip_cleanup: true
  github_token:
    secure: aOQVIn4pCEjtabYHwdJwpKV/kk9ez+Azr3LrNhykS8kpnNowyzP3ALRZSyvW+GtngeVb52dyPn6RuEPLPGZdRaojz+PzD+utQfVzriE4aPM+h/9+HBp4TeS/LNok81gy/TDQa0hAgVrscPnV3dZzSqA5kr2suT+EI+MJNu4rxtGxBM/JP+j9FCGueapa/tO4IW9+2BsIzcEKidOxZRQRrUC6qygLsU/SHTIWewMZTVFpsm33MtFtVV1g5uTx2fUeIi5O/L5EybLHvBQ659FDYpdIcP3pOC2jdLAGtNBVM1/3TzqF1KnE9Lw7qXFF8fBx7BKxFgdtqmWqXeYufBWJB2qRE32xYW9V2h8CKb/sH2yyqHPftbworu2IuAv911xqlWE2Dv4RXtsgfDgsF6V8AxfEPOsCv4zQRx5haHaf2TJe0yTm2jLzhul67D8kkgLwZanL4i0mxvsrharCZSxK5AfvRtX4Cc58bCybcopnQsTFh2P7pJeQ1K6gZ3xZEND9WQPngPx3gT8csH67r16PQefpg8EvonkwFTopOK6Ur2hn+ZsbBIsG38q59rkEEi74X29xyxltRK3/eStNkmr3u8zuBgC4r3FoNBOuwDXMbMtc/eLhIro6sm6PA0YfSm9efoSdXLV/dYR/bS5SBNpdluTDGmBRCwWrSmtvVr1dOVE=
  keep_history: true
  verbose: true
  on:
    all_branches: true
    condition: $TRAVIS_BRANCH =~ ^build|frontend|backend$

notifications:
  slack:
    template:
      - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of *%{repository_slug}* @ %{branch} %{result} in %{duration}"
    rooms:
      secure: "b31clt8CBoU3DppPKzuPvyJAB8VznArab9UQtnEp11n1uKP1QEOxqq2kiPD/8iYBS7MbrtXn2+RVkwyoewojNOUe9Fq1nsTZfF8u/hl2LgW1eZNJNLBYoQYBHQakmH/Qp/1bxu9Nf95llzPtqQVl5F4YxGqdzQKwkGb2MECytweQF5NXzMcb4luBSVMZDI6VaEVMfkFXl2jHdGKiXst4VewYSnwtAEsCwyz0IFbx6G8+dvcN+paKnzjICOs4S1NM3UZnb35zENXID+4e2FOaYvJ1EGkkFx+JYaWZpA7RYe19tkaOICkkhnIoTn165pybLV+3LPU/e3RvLOxMMubN93t0Aaq41/vnrgrnzoz6J/r+jUOWiBMI8oicyTdri/j6Foomjbv9WVLbaG8LwqyFXTEHLlvwdaEZSZMhFfPDXyB3awZ48WEhZHntZTcG90ynPH/bu7oKhqhA5NFIqxottmnJZTxLlDTvQ38FHdCltxuYr7T7/IJBfSrl5dCjRMxyG+LFmXpenogFTSf39mSAK84JqDe2Toz8AjkZkod8swpkRuRjHZCzsceDVuUR3Q4ccKwHXwLFaobq1Km8VnWbe6IWUaCGatXAafM/qDkIGSs9Y49oLZkXb3cdVaw/cg+Ah9a4oE62erD4SfWMRttg0tykLwmXDSg2rayMtGtLP/U="
